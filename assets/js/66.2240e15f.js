(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{486:function(s,n,a){"use strict";a.r(n);var t=a(23),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx使用手册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx使用手册"}},[s._v("#")]),s._v(" Nginx使用手册")]),s._v(" "),a("p",[s._v("Nginx是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。")]),s._v(" "),a("h2",{attrs:{id:"下载nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载nginx"}},[s._v("#")]),s._v(" 下载Nginx")]),s._v(" "),a("p",[s._v("先"),a("a",{attrs:{href:"http://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载Nginx"),a("OutboundLink")],1),s._v("，以windows版为例，下载后niginx压缩包并解压到任意目录，双击nginx.exe，在浏览器中访问"),a("a",{attrs:{href:"http://localhost",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost"),a("OutboundLink")],1),s._v("，如果出现"),a("code",[s._v("Welcome to nginx!")]),s._v("页面则说明成功。")]),s._v(" "),a("h2",{attrs:{id:"nginx常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用命令"}},[s._v("#")]),s._v(" nginx常用命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("nginx -h        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开帮助")]),s._v("\nnginx -t        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置文件是否正确")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下命令均要先启动nginx才能执行")]),s._v("\nnginx -s stop   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止")]),s._v("\nnginx -s quit   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出")]),s._v("\nnginx -s reopen "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新启动（注意不会重新读取配置文件）")]),s._v("\nnginx -s reload "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新读取配置文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"部署项目到nginx根目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署项目到nginx根目录"}},[s._v("#")]),s._v(" 部署项目到Nginx根目录")]),s._v(" "),a("p",[s._v("以vue项目为例，使用命令"),a("code",[s._v("npm run build")]),s._v("创建输出文件，将dist文件夹下的所有内容复制到nginx目录下的"),a("code",[s._v("webapp/")]),s._v("内（没有的话自行创建）。")]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("nginx")]),s._v("目录中的"),a("code",[s._v("conf/nginx.conf")]),s._v("文件，在 http -> server 节点中，修改location节的内容：")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location / {\n    root   webapp;\n    index  index.html index.htm;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"多个项目部署到nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多个项目部署到nginx"}},[s._v("#")]),s._v(" 多个项目部署到Nginx")]),s._v(" "),a("p",[s._v("有时一个Nginx中放了好几个子项目，需要将不同的项目通过不同的路径来访问。")]),s._v(" "),a("p",[s._v("对于项目1而言，修改"),a("code",[s._v("vue.config.js")]),s._v("文件的"),a("code",[s._v("publicPath")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("publicPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/vue1/'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("对于项目2而言，修改"),a("code",[s._v("vue.config.js")]),s._v("文件的"),a("code",[s._v("publicPath")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("publicPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/vue2/'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("分别在vue项目根目录中使用命令"),a("code",[s._v("npm run build")]),s._v("创建输出文件，将dist文件夹下的所有内容复制到nginx目录下的"),a("code",[s._v("webapp/vue1")]),s._v("和"),a("code",[s._v("webapp/vue2")]),s._v("内（没有的话自行创建）。")]),s._v(" "),a("p",[s._v("修改nginx目录中的conf/nginx.conf文件，在 http -> server 节点中，修改location节的内容：")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /vue1 {\n    root   webapp;\n    index  index.html index.htm;\n}\n\nlocation /vue2 {\n    root   webapp;\n    index  index.html index.htm;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在nginx根目录使用命令"),a("code",[s._v("nginx -s reload")]),s._v("即可在浏览器中通过"),a("code",[s._v("http://localhost/vue1")]),s._v("、"),a("code",[s._v("http://localhost/vue2")]),s._v("访问项目1、项目2。")]),s._v(" "),a("h2",{attrs:{id:"端口代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口代理"}},[s._v("#")]),s._v(" 端口代理")]),s._v(" "),a("p",[s._v("当前后端项目分别部署在同一台机器上时，由于无法使用相同的端口，故后端一般会将端口号设置成不同的值（例如8080），但是当前端向后端请求资源时还要加上端口号，未免显得麻烦，故利用可以nginx将前端的指定路径代理到后端的8080端口上。")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("conf/nginx.conf")]),s._v("文件中增加"),a("code",[s._v("location")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /api {\n    proxy_pass http://localhost:8080/api;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这样，当前端访问/api路径时，实际上访问的是"),a("code",[s._v("http://localhost:8080/api")]),s._v("路径。")]),s._v(" "),a("h2",{attrs:{id:"vue使用nginx发布后刷新页面报404错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue使用nginx发布后刷新页面报404错误"}},[s._v("#")]),s._v(" Vue使用Nginx发布后刷新页面报404错误")]),s._v(" "),a("p",[a("em",[s._v("问题现象：")])]),s._v(" "),a("p",[s._v("使用Vue-cli构建的项目，在本地调试运行都是OK的，打包之后使用Nginx发布后，指定跳转页面是ok的，但是刷新页面，reload页面时，报错404，找不到页面。Nginx端日志显示找不到资源路径。")]),s._v(" "),a("p",[a("em",[s._v("解决方案：")])]),s._v(" "),a("h4",{attrs:{id:"方案1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案1"}},[s._v("#")]),s._v(" 方案1")]),s._v(" "),a("p",[s._v("首先，出问题的原因是：在 Vue 项目中，可以选择 hash或者 history.pushState() 实现路由跳转。")]),s._v(" "),a("p",[s._v("使用history模式的配置是：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'history'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("那么，当我们 npm run build 完成并部署到服务器后，刷新某个路由下的页面，会出现 404 或者 502 错误。")]),s._v(" "),a("p",[s._v("这是因为刷新页面时访问的资源在服务端找不到，因为vue-router设置的路径不是真实存在的路径。所以把mode改为hash模式就可以了。")]),s._v(" "),a("h4",{attrs:{id:"方案2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案2"}},[s._v("#")]),s._v(" 方案2")]),s._v(" "),a("p",[s._v("继续使用history模式，修改Nginx的配置，使所有的请求都定向到index.html页面")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\ttry_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ @router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tindex index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tlocation @router "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\trewrite ^.*$ /index.html last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"nginx做代理时x-forwarded-for信息头的处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx做代理时x-forwarded-for信息头的处理"}},[s._v("#")]),s._v(" Nginx做代理时X-Forwarded-For信息头的处理")]),s._v(" "),a("p",[s._v("X-Forwarded-For:简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/duhuo/p/5700900.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考地址"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("server\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http://127.0.0.1:3000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_redirect off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    client_max_body_size 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许客户端请求的最大单文件字节数")]),s._v("\n    client_body_buffer_size 128k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓冲区代理缓冲用户端请求的最大字节数，")]),s._v("\n    proxy_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx跟后端服务器连接超时时间(代理连接超时)")]),s._v("\n    proxy_send_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端服务器数据回传时间(代理发送超时)")]),s._v("\n    proxy_read_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接成功后，后端服务器响应时间(代理接收超时)")]),s._v("\n    proxy_buffer_size 4k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置代理服务器（nginx）保存用户头信息的缓冲区大小")]),s._v("\n    proxy_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 32k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_buffers缓冲区，网页平均在32k以下的设置")]),s._v("\n    proxy_busy_buffers_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 高负荷下缓冲大小（proxy_buffers*2）")]),s._v("\n    proxy_temp_file_write_size 64k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"相关推荐地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关推荐地址"}},[s._v("#")]),s._v(" 相关推荐地址")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6899605130052632589#heading-4",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx的配置和使用"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=e.exports}}]);