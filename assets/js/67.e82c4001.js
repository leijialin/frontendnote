(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{487:function(s,a,n){"use strict";n.r(a);var t=n(23),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"pm2-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pm2-概述"}},[s._v("#")]),s._v(" pm2 概述")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://pm2.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pm2（process manager）"),n("OutboundLink")],1),s._v("是一个进程管理工具，维护一个进程列表，可以用它来管理你的node进程，负责所有正在运行的进程，并查看node进程的状态，也支持性能监控，负载均衡等功能。")]),s._v(" "),n("h3",{attrs:{id:"pm2特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pm2特点"}},[s._v("#")]),s._v(" pm2特点")]),s._v(" "),n("ul",[n("li",[s._v("监听文件变化，自动重启程序")]),s._v(" "),n("li",[s._v("支持性能监控")]),s._v(" "),n("li",[s._v("负载均衡")]),s._v(" "),n("li",[s._v("程序崩溃自动重启")]),s._v(" "),n("li",[s._v("服务器重新启动时自动重新启动")]),s._v(" "),n("li",[s._v("自动化部署项目")])]),s._v(" "),n("h2",{attrs:{id:"pm2安装与使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pm2安装与使用"}},[s._v("#")]),s._v(" pm2安装与使用")]),s._v(" "),n("h3",{attrs:{id:"全局安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局安装"}},[s._v("#")]),s._v(" 全局安装")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pm2 -g \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),n("ul",[n("li",[s._v("启动一个node程序")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 start start.js \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/leijialin/noteImages/notes/technology/pm2/1.png",alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("启动进程并指定应用的程序名")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 start app.js --name application1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("停止指令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 stop name\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("集群模式启动")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i 表示 number-instances 实例数量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# max 表示 PM2将自动检测可用CPU的数量 可以自己指定数量")]),s._v("\npm2 start start.js -i max\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/leijialin/noteImages/notes/technology/pm2/2.png",alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("添加进程监视")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("// 在文件改变的时候会重新启动程序\npm2 start app.js --name start --watch\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/leijialin/noteImages/notes/technology/pm2/3.png",alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("列出所有进程")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 list\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 简写")]),s._v("\npm2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("从进程列表中删除进程")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pm2 delete [appname] | id")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定进程名删除")]),s._v("\npm2 delete app\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定进程id删除")]),s._v("\npm2 delete "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("删除进程列表中所有进程")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 delete all\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("查看某个进程具体情况")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 describe app\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("查看进程的资源消耗情况")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 monit\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("重启进程")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启指定名称的进程")]),s._v("\npm2 restart app\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启所有进程")]),s._v("\npm2 restart all\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("查看进程日志")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看该名称进程的日志")]),s._v("\npm2 logs app\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有进程的日志")]),s._v("\npm2 logs all\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("设置pm2开机自启")])]),s._v(" "),n("p",[s._v("开启启动设置，此处是CentOS系统，其他系统替换最后一个选项（可选项：ubuntu, centos, redhat, gentoo, systemd, darwin, amazon）")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 startup centos \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后按照提示需要输入的命令进行输入\n最后保存设置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 save\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("查看当前应用运行的路径信息")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2 show AppName\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"window-设置pm2开机自启动服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#window-设置pm2开机自启动服务"}},[s._v("#")]),s._v(" Window 设置pm2开机自启动服务")]),s._v(" "),n("ol",[n("li",[s._v("安装 pm2")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i -g pm2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("安装并配置 pm2-windows-service")])]),s._v(" "),n("p",[s._v("pm2-windows-service可以将 pm2 安装成 windows service, 达到开机运行的目的")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i -g pm2-windows-service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("添加pm2环境变量")])]),s._v(" "),n("ul",[n("li",[s._v("添加系统环境变量 PM2_HOME=D:.pm2")]),s._v(" "),n("li",[s._v("右键 [我的电脑] - [属性] - [高级系统设置] - [环境变量] - 新建 [系统变量]")]),s._v(" "),n("li",[s._v("名称PM2_HOME")]),s._v(" "),n("li",[s._v("路径D:.pm2（这路径根据自己需要定）")])]),s._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[s._v("安装服务")])]),s._v(" "),n("p",[s._v("以管理员权限打开新的命令行窗口,执行以下命令来安装服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2-service-install\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("code",[s._v("Perform environment setup ?")]),s._v(" 选 n, 继续\n此时, PM2服务已安装成功并已启动, 可以通过 Wn+R来查看，输入 "),n("code",[s._v("services.msc")]),s._v(" 即可看到服务")]),s._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[s._v("卸载服务")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pm2-service-uninstall\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"使用pm2在同服务器配置开发、生产、测试等环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用pm2在同服务器配置开发、生产、测试等环境"}},[s._v("#")]),s._v(" 使用pm2在同服务器配置开发、生产、测试等环境")]),s._v(" "),n("ul",[n("li",[s._v("创建"),n("code",[s._v("pm2.config.js")]),s._v("文件（其中name显示为pm2 list中的应用名，script为启动文件相对当前文件位置）")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    apps "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            script"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            watch"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            ignore_watch"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n            env"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PORT"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NODE_ENV"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"development"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            env_production"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PORT"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NODE_ENV"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"production"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("使用命令"),n("code",[s._v("pm2 start pm2.config.js --env production")]),s._v("启动")])]),s._v(" "),n("h3",{attrs:{id:"配置文件解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置文件解析"}},[s._v("#")]),s._v(" 配置文件解析")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". apps:json结构，apps是一个数组，每一个数组成员就是对应一个pm2中运行的应用\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". name:应用程序名称"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app"')]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". cwd:应用程序所在的目录"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./"')]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". script:应用程序的脚本路径"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./"')]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". log_date_format: 日志文件名输出日期格式"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YYYY-MM-DD HH:mm Z"')]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(". error_file:自定义应用程序的错误日志文件"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-err.log"')]),s._v(",\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(". out_file:自定义应用程序日志文件"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-out.log"')]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(". instances: 应用启动实例个数，仅在cluster模式有效 默认为fork；或者 max\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(". min_uptime:最小运行时间，这里设置的是60s即如果应用程序在60s内退出，pm2会认为程序异常退出，此时触发重启max_restarts设置数量\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(". max_restarts:设置应用程序异常退出重启的次数，默认15次（从0开始计数）\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(". cron_restart:定时启动，解决重启能解决的问题\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(". watch:是否启用监控模式，默认是false。如果设置成true，当应用程序变动时，pm2会自动重载。这里也可以设置你要监控的文件。\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ignore_watch"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                           // 不用监听的文件\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(". merge_logs:// 设置追加日志而不是新建日志\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(". exec_interpreter:应用程序的脚本类型，这里使用的shell，默认是nodejs\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(". exec_mode:应用程序启动模式，这里设置的是cluster_mode（集群），默认是fork\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(". autorestart:启用/禁用应用程序崩溃或退出时自动重启,默认为true, 发生异常的情况下自动重启\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(". vizion:启用/禁用vizion特性"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("版本控制"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"args"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(", // 传递给脚本的参数\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(". env: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        PM2_SERVE_PATH: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./apidoc"')]),s._v(",    //静态服务路径\n        PM2_SERVE_PORT: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(",   //静态服务器访问端口\n        NODE_ENV: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'development'")]),s._v(" //启动默认模式\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(". env_production "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      NODE_ENV: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),s._v("  //使用production模式 pm2 start ecosystem.config.js --env production\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("h2",{attrs:{id:"常见问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),n("ul",[n("li",[s._v("pm2处理文件上传问题")])]),s._v(" "),n("p",[n("strong",[s._v("问题：")]),s._v(" node项目在使用pm2启动项目时,开启watch监听会导致文件上传(上传至该项目内部的情况)出现服务器502的问题,或文件上传一直pending中,返回未登录.")]),s._v(" "),n("p",[n("strong",[s._v("原因：")]),s._v(" pm2监听到项目内部文件修改,自动重启项目,导致session刷新,上传失败以及各种各样的问题.")]),s._v(" "),n("p",[n("strong",[s._v("解决：")]),s._v(" 如果项目中有使用文件上传功能,且该功能是上传至项目目录本身的情况下,服务器启动时不能开启watch监听,只能使用")]),s._v(" "),n("h2",{attrs:{id:"学习文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#学习文档"}},[s._v("#")]),s._v(" 学习文档")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/lentoo/p/9539137.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("不懂代码的攻城师"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/6cb523c0ced8?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation",target:"_blank",rel:"noopener noreferrer"}},[s._v("简书-windows设置开机自启动"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);